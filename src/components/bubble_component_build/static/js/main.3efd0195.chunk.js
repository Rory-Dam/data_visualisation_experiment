(this.webpackJsonpstreamlit_viewership_component=this.webpackJsonpstreamlit_viewership_component||[]).push([[0],{127:function(t,e,a){},129:function(t,e,a){"use strict";a.r(e);var n,i=a(12),r=a.n(i),o=a(45),s=a.n(o),c=a(9),l=a(0),p=a(1),d=a(2),u=a(3),h=a(21),m=a(8),f=a(47),v=(a(127),a(13)),y=function(t){Object(d.a)(a,t);var e=Object(u.a)(a);function a(){var t;Object(l.a)(this,a);for(var i=arguments.length,r=new Array(i),o=0;o<i;o++)r[o]=arguments[o];return(t=e.call.apply(e,[this].concat(r))).componentDidMount=function(){var e=t.get_dimensions(),a=Object(c.a)(e,3),i=a[0],r=a[1],o=a[2];var s=m.h("#"+n).append("svg").attr("width",i+o.left+o.right).attr("height",r+o.top+o.bottom).call((function(t){var e=m.h(t.node().parentNode),a=parseInt(t.style("width")),n=parseInt(t.style("height")),i=a/n;function r(){var a=parseInt(e.style("width"));t.attr("width",a),t.attr("height",Math.round(a/i)),h.a.setFrameHeight()}t.attr("viewBox","0 0 "+a+" "+n).attr("perserveAspectRatio","xMinYMid").call(r),m.h(window).on("resize."+e.attr("id"),r)})).append("g").attr("transform","translate(".concat(o.left,", ").concat(o.top,")"));s.append("defs").append("svg:clipPath").attr("id","clip").append("svg:rect").attr("width",i).attr("height",r).attr("x",0).attr("y",0);s.append("rect").attr("id","zoomRect").attr("width",i+o.left+o.right).attr("height",r).style("fill","none").style("pointer-events","all").attr("transform","translate("+-o.left+",0)"),s.append("g").attr("transform","translate(0,".concat(r,")")).attr("id","myXaxis"),s.append("g").attr("id","myYaxis"),m.h("body").append("div").attr("class","svg-tooltip").style("font-family",'-apple-system, system-ui, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif, "Apple   Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"').style("border-radius",".1rem").style("font-size","14px").style("max-width","320px").style("text-overflow","ellipsis").style("white-space","pre").style("z-index","300").style("background","rgba(69,77,93,.9)").style("color","#fff").style("display","block").style("padding",".2rem .4rem").style("position","absolute").style("visibility","hidden"),s.append("text").attr("id","yLabel").attr("transform","rotate(-90)").attr("y",-o.left).attr("x",-r/2).attr("dy","1em").style("font-size",20).style("text-anchor","middle"),s.append("g").attr("class","legendSize").attr("transform","translate(".concat(i+10,", 20)")),h.a.setFrameHeight()},t.render=function(){return n="bubble_component_"+t.props.args.key,Object(v.jsxs)("span",{children:[Object(v.jsx)("div",{id:n}),Object(v.jsx)("div",{className:"button_container",id:"chapter_button_container"}),Object(v.jsxs)("div",{className:"button_container",children:[Object(v.jsx)("a",{id:"show_all_button",className:"ripple_button",children:"Show All"}),Object(v.jsx)("a",{id:"swap_view_button",className:"ripple_button",children:"Swap View"})]})]})},t}return Object(p.a)(a,[{key:"get_data",value:function(){for(var t=this.props.args.data,e=[],a=t.columns,n=function(n){var i=m.e(0,a).map((function(e){var a=t.getCell(n,e),i=(a.classNames,a.content);a.id,a.type;return null===i||void 0===i?void 0:i.toString()}));e.push({index:n,episode:parseInt(i[1]),act:i[2],chapter:i[3],segment:i[4],start_time:parseFloat(i[5]),end_time:parseFloat(i[6]),viewership:parseFloat(i[7])})},i=1;i<t.rows;i++)n(i);return e}},{key:"get_metadata",value:function(){return this.props.args.metadata}},{key:"get_theme",value:function(){return this.props.theme}},{key:"get_dimensions",value:function(){var t={top:80,right:150,bottom:80,left:80};return[1200-t.left-t.right,600-t.top-t.bottom,t]}},{key:"componentDidUpdate",value:function(){var t,e,a=this,i=this.get_data(),r=this.get_metadata(),o=this.get_dimensions(),s=Object(c.a)(o,3),l=s[0],p=s[1],d=(s[2],r.colour),u=m.h("#"+n).select("svg").select("g"),v={};r.chapter_order.map((function(t,e){t in v||(v[t]=e+1)}));var y=Object.keys(v).length,g=i.sort((function(t,e){return t.end_time-t.start_time>e.end_time-e.start_time?-1:t.end_time-t.start_time<e.end_time-e.start_time?1:0})),b=m.f().domain([0,y+1]).range([0,l]),w=m.f().domain([0,1.1*m.c(i,(function(t){return t.viewership}))]).range([p,0]),_=m.f().domain([0,Math.sqrt(m.d(i,(function(t){return t.end_time-t.start_time})))/Math.PI]).range([0,l/m.c(i,(function(t){return t.episode}))/2*.5]),x=m.h("#myXaxis"),k=m.h("#myYaxis"),j={};Object.keys(v).map((function(t,e){j[e+1]=t})),x.call(m.a(b).ticks(y).tickFormat((function(t){return j[t]}))),k.call(m.b(w).tickSize(-l)),k.selectAll("text").style("font-size","15");var A=m.h("body").select(".svg-tooltip"),O=!1;u.select("#dataCircle").empty()||"episode"===u.select("#dataCircle").attr("view")&&(O=!0),u.selectAll("#dataCircle").data(g).join("circle").attr("id","dataCircle").attr("view","chapter").attr("clip-path","url(#clip)").attr("r",(function(t){return _(Math.sqrt(t.end_time-t.start_time)/Math.PI)})).attr("cx",(function(t){return b(v[t.chapter])})).attr("cy",(function(t){return w(t.viewership)})).attr("fill",(function(t){return d[t.chapter]})).style("opacity","0.7").style("pointer-events","auto").on("mouseover",(function(t,e){m.h(t.target).attr("stroke-width","1").attr("stroke","black"),A.style("visibility","visible").text("Viewership: ".concat(Math.round(e.viewership),"\nEpisode: ").concat(e.episode,"\n")+"Act: ".concat(e.act,"\nChapter: ").concat(e.chapter,"\nSegment: ").concat(e.segment,"\n")+"Start(s): ".concat(e.start_time,"\nEnd(s): ").concat(e.end_time))})).on("mousemove",(function(t){A.style("top",t.pageY-10+"px").style("left",t.pageX+10+"px")})).on("mouseout",(function(t){m.h(t.target).attr("stroke-width",null).attr("stroke",null),A.style("visibility","hidden")})).attr("view","chapter"),u.select("#yLabel").text("".concat(r.metric));var S=Math.pow(10,Math.floor(Math.log10(m.c(i,(function(t){return t.end_time-t.start_time}))))),z=[.1,.25,.5,1].map((function(t){return t*S})),M=z.map((function(t){return _(Math.sqrt(t)/Math.PI)})),C=m.g().domain(z.map((function(t){return"".concat(t,"s")}))).range(M),F=f.a.legendSize().ascending(!0).title("Segement Time").shape("circle").shapePadding(5).labelOffset(10).orient("vertical").scale(C);u.select(".legendSize").call(F).selectAll("circle").style("opacity",.5),u.select(".legendSize").selectAll("text").style("font-size","20");var I=m.i().scaleExtent([1,20]).extent([[0,0],[l,p]]).on("zoom",(function(t){if(!isNaN(t.transform.k)){var e=t.transform.rescaleY(w);k.call(m.b(e).tickSize(-l)),k.selectAll("text").style("font-size","15"),u.selectAll("#dataCircle").attr("cy",(function(t){return e(t.viewership)}))}}));function E(t){var e=t.clientX-t.target.offsetLeft,a=t.clientY-t.target.offsetTop,n=document.createElement("div");n.style.left=e+"px",n.style.top=a+"px",t.target.append(n),setTimeout((function(){n.remove()}),800)}u.select("#zoomRect").call(I),null===(t=document.getElementById("zoomRect"))||void 0===t||t.dispatchEvent(new WheelEvent("wheel",{deltaY:1})),null===(e=document.getElementById("zoomRect"))||void 0===e||e.dispatchEvent(new WheelEvent("wheel",{deltaY:-1})),O&&this.swapView(r.chapter_order,0),m.h("#swap_view_button").on("click",(function(t){E(t),a.swapView(r.chapter_order)})),m.h("#show_all_button").on("click",(function(t){E(t),a.showAll()}));var N=m.h("#chapter_button_container"),Y=this.swapShowChapter;N.selectAll(".ripple_button").data(Object.keys(v)).join("a").attr("id",(function(t){return"show_".concat(t,"_button")})).attr("class","ripple_button").style("background-color",(function(t){return d[t]})).style("color",(function(t){return function(t){t=t.replace("#","");var e=(.299*parseInt(t.substr(0,2),16)+.587*parseInt(t.substr(2,2),16)+.114*parseInt(t.substr(4,2),16))/255;return(Math.max(e,.1)+.05)/(Math.min(e,.1)+.05)>=4.5?"#000000":"#FFFFFF"}(d[t])})).text((function(t){return t})).on("click",(function(t,e){m.h(this).style("opacity","1"===m.h(this).style("opacity")?"0.5":"1"),Y(e)})),h.a.setFrameHeight()}},{key:"swapView",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:800,a=m.h("#"+n).select("svg").select("g");"chapter"!==a.select("#dataCircle").attr("view")?"episode"!==a.select("#dataCircle").attr("view")||function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:800,a={top:80,right:150,bottom:80,left:80},i=1200-a.left-a.right,r=(a.top,a.bottom,m.h("#"+n).select("svg").select("g")),o={};null===t||void 0===t||t.map((function(t,e){t in o||(o[t]=e+1)}));var s=Object.keys(o).length,c=m.f().domain([0,s+1]).range([0,i]),l=m.h("#myXaxis"),p={};Object.keys(o).map((function(t,e){p[e+1]=t})),l.transition().duration(e).call(m.a(c).ticks(s).tickFormat((function(t){return p[t]}))),r.selectAll("#dataCircle").attr("view","chapter").transition().duration(e).attr("cx",(function(t){return c(o[t.chapter])}))}(t,e):function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:800,e={top:80,right:150,bottom:80,left:80},a=1200-e.left-e.right,i=(e.top,e.bottom,m.h("#"+n).select("svg").select("g")),r=0;i.selectAll("#dataCircle").each((function(t){t.episode>r&&(r=t.episode)}));var o=m.f().domain([0,r+1]).range([0,a]);m.h("#myXaxis").transition().duration(t).call(m.a(o).ticks(r).tickFormat((function(t){if(t>0&&t<=r)return"Episode ".concat(t)}))),i.selectAll("#dataCircle").attr("view","episode").transition().duration(t).attr("cx",(function(t){return o(t.episode)}))}(e)}},{key:"showAll",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:400;m.h("#"+n).select("svg").select("g").selectAll("#dataCircle").transition().duration(t).style("opacity","0.7").style("pointer-events","auto"),m.h("#chapter_button_container").selectAll(".ripple_button").style("opacity","1")}},{key:"swapShowChapter",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:400;m.h("#"+n).select("svg").select("g").selectAll("#dataCircle").transition().duration(e).style("opacity",(function(e){return e.chapter===t?"0.7"===m.h(this).style("opacity")?"0":"0.7":m.h(this).style("opacity")})).style("pointer-events",(function(e){return e.chapter===t?"auto"===m.h(this).style("pointer-events")?"none":"auto":m.h(this).style("pointer-events")}))}}]),a}(h.b),g=Object(h.c)(y);s.a.render(Object(v.jsx)(r.a.StrictMode,{children:Object(v.jsx)(g,{})}),document.getElementById("root"))}},[[129,1,2]]]);
//# sourceMappingURL=main.3efd0195.chunk.js.map