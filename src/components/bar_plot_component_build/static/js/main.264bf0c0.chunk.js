(this.webpackJsonpstreamlit_viewership_component=this.webpackJsonpstreamlit_viewership_component||[]).push([[0],{226:function(t,e,a){"use strict";a.r(e);var r,n,o=a(0),i=a.n(o),s=a(50),c=a.n(s),l=a(9),d=a(1),p=a(2),u=a(3),m=a(4),h=a(53),g=a(16),f=a(65),v=a(231),y=a(34),x=a(222),b=function(t){Object(u.a)(a,t);var e=Object(m.a)(a);function a(){var t;Object(d.a)(this,a);for(var o=arguments.length,i=new Array(o),s=0;s<o;s++)i[s]=arguments[s];return(t=e.call.apply(e,[this].concat(i))).componentDidMount=function(){t.get_data();var e=t.get_metadata(),a=t.get_dimensions(),o=Object(l.a)(a,3),i=o[0],s=o[1],c=o[2];e.colour,t.get_theme();t.setState({zoom:[1,r]});var d=g.g("#"+n).append("svg").attr("width",i+c.left+c.right).attr("height",s+c.top+c.bottom).call((function(t){var e=g.g(t.node().parentNode),a=parseInt(t.style("width")),r=parseInt(t.style("height")),n=a/r;function o(){var a=parseInt(e.style("width"));t.attr("width",a),t.attr("height",Math.round(a/n)),h.a.setFrameHeight()}t.attr("viewBox","0 0 "+a+" "+r).attr("perserveAspectRatio","xMinYMid").call(o),g.g(window).on("resize."+e.attr("id"),o)})).append("g").attr("transform","translate(".concat(c.left,",").concat(c.top,")"));d.append("defs").append("svg:clipPath").attr("id","clip").append("svg:rect").attr("width",i).attr("height",s).attr("x",0).attr("y",0);d.append("g").attr("transform","translate(0,".concat(s,")")).attr("id","myXaxis"),d.append("g").attr("id","myYaxis"),g.g("body").append("div").attr("class","svg-tooltip").style("font-family",'-apple-system, system-ui, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif, "Apple   Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"').style("border-radius",".1rem").style("font-size","14px").style("max-width","320px").style("text-overflow","ellipsis").style("white-space","pre").style("z-index","300").style("background","rgba(69,77,93,.9)").style("color","#fff").style("display","block").style("padding",".2rem .4rem").style("position","absolute").style("visibility","hidden"),d.append("text").attr("id","yLabel").attr("transform","translate("+i/2+" ,"+"-10)").style("font-size",25).style("text-anchor","middle"),d.append("text").attr("id","topLabel").attr("transform","rotate(-90)").attr("y",-c.left).attr("x",-s/2).attr("dy","1em").style("font-size",25).style("text-anchor","middle"),d.append("g").attr("class","legendGrid").attr("transform","translate(".concat(i+20,",").concat(s-20,")")),h.a.setFrameHeight()},t.render=function(){var e=t.get_data(),a=t.get_dimensions(),o=Object(l.a)(a,3),i=(o[0],o[1],o[2]),s=t.get_theme(),c=e.map((function(t){return t.episode.toString()})).filter((function(t,e,a){return a.indexOf(t)===e}));r=c.length,n="viewership_component_"+t.props.args.key;var d={};return c.map((function(t,e){return d[e+1]="".concat(t)})),Object(y.jsxs)("span",{children:[Object(y.jsx)("div",{id:n}),Object(y.jsx)("div",{style:{margin:"40px ".concat(i.right/2,"px 40px ").concat(i.left/2,"px")},id:n+"_silder",children:Object(y.jsx)(f.a,{theme:{token:{colorPrimary:null===s||void 0===s?void 0:s.secondaryBackgroundColor,colorFillContentHover:null===s||void 0===s?void 0:s.secondaryBackgroundColor,colorPrimaryBorder:null===s||void 0===s?void 0:s.secondaryBackgroundColor,colorPrimaryBorderHover:null===s||void 0===s?void 0:s.secondaryBackgroundColor}},children:Object(y.jsx)(v.a,{range:!0,id:"zoomSlider",min:1,max:r,marks:d,step:1,defaultValue:[1,r],onAfterChange:t.changeEpisodeBounds,tooltip:{open:!1},disabled:t.props.disabled})})})]})},t.changeEpisodeBounds=function(e){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:800,o=1200-80-220,i=600-30-30,s=e[0],c=e[1],l=c-s+1,d=g.g("#"+n).select("svg").select("g"),p=d.select("#myXaxis"),u=[],m={};d.selectAll(".dataRect").each((function(t){u.push(t.episode)}));u=u.filter((function(t,e,a){return a.indexOf(t)===e})),u.map((function(t,e){return m[t]=e+1})),console.log(u),console.log(m);var h=g.k().scaleExtent([1,r]).on("zoom",(function(t){var e=g.f().domain([.5,r+.5]).range([0,o]),a=t.transform.rescaleX(e);p.call(g.a(a).ticks(l).tickFormat((function(t){return t-1>-1&&t-1<u.length?"Episode ".concat(u[t-1]):""})).tickSize(0)),p.selectAll(".tick text").attr("font-size","".concat(Math.min(150/l,20))),d.selectAll(".dataRect").attr("x",(function(t){return a(t.start_time+m[t.episode]-.5)})).attr("width",(function(t){return a(t.end_time+m[t.episode]-.5)-a(t.start_time+m[t.episode]-.5)})).attr("stroke-width","".concat(Math.min(.7,4/l))),d.selectAll(".gridLine").attr("d",(function(t){var e=g.d();return e.moveTo(a(t),0),e.lineTo(a(t),i+10),e}))})),f=x.cloneDeep(g.l);f.k=r/l,f.x=o/l*(1-s),d.transition().duration(a).call(h.transform,f),t.setState({zoom:[s,c]})},t}return Object(p.a)(a,[{key:"get_data",value:function(){for(var t=this.props.args.data,e=[],a=t.columns,r=function(r){var n=g.e(0,a).map((function(e){var a=t.getCell(r,e),n=(a.classNames,a.content);a.id,a.type;return null===n||void 0===n?void 0:n.toString()}));e.push({index:r,episode:parseInt(n[1]),act:n[2],chapter:n[3],segment:n[4],start_time:parseFloat(n[5]),end_time:parseFloat(n[6]),viewership:parseFloat(n[7])})},n=1;n<t.rows;n++)r(n);return e}},{key:"get_metadata",value:function(){return this.props.args.metadata}},{key:"get_theme",value:function(){return this.props.theme}},{key:"get_dimensions",value:function(){var t={top:30,right:220,bottom:30,left:80};return[1200-t.left-t.right,600-t.top-t.bottom,t]}},{key:"componentDidUpdate",value:function(){var t=this.get_data(),e=this.get_metadata(),a=this.get_dimensions(),o=Object(l.a)(a,3),i=o[0],s=o[1],c=(o[2],e.colour),d=this.get_theme(),p=g.g("#"+n).select("svg").select("g");p.select("#yLabel").text("".concat(e.granularity)),p.select("#topLabel").text("".concat(e.metric));var u=g.f().domain([.5,r+.5]).range([0,i]),m=g.f().range([s,0]),f=this.state.zoom[0],v=this.state.zoom[1]-f+1,y=x.cloneDeep(g.l);y.k=r/v,y.x=i/v*(1-f),u=y.rescaleX(u);var b=p.select("#myXaxis"),k=p.select("#myYaxis"),w=function(t,e,a){return a.indexOf(t)===e},_=t.map((function(t){return t.episode})).filter(w),j={};_.map((function(t,e){return j[t]=e+1})),b.call(g.a(u).ticks(v).tickFormat((function(t){return t-1>-1&&t-1<_.length?"Episode ".concat(_[t-1]):""})).tickSize(0)),b.selectAll(".tick text").attr("font-size","".concat(Math.min(150/v,20))),m.domain([0,1.1*g.c(t,(function(t){return t.viewership}))]),k.call(g.b(m)),k.selectAll(".tick text").attr("font-size","15"),p.selectAll(".dataRect").data(t).join("rect").attr("clip-path","url(#clip)").attr("x",(function(t){return u(t.start_time+j[t.episode]-.5)})).attr("width",(function(t){return u(t.end_time+j[t.episode]-.5)-u(t.start_time+j[t.episode]-.5)})).attr("y",(function(t){return m(t.viewership)})).attr("height",(function(t){return s-m(t.viewership)})).attr("fill",(function(t){return c[t.act][t.chapter]})).attr("class","dataRect").attr("stroke-width","".concat(Math.min(.7,4/v))).attr("stroke","white");for(var O=[],z=1;z<r+1;z++)O.push(z+.5);p.selectAll(".gridLine").data(O).join("path").attr("clip-path","url(#clip)").attr("d",(function(t){var e=g.d();return e.moveTo(u(t),0),e.lineTo(u(t),s+10),e})).attr("fill","none").attr("stroke",d?d.textColor:"rgb(150,150,150)").attr("stroke-width",1).attr("class","gridLine");var A=g.g("body").select(".svg-tooltip");g.h(".dataRect").on("mouseover",(function(t,e){g.g(t.target).attr("stroke-width-cache",g.g(t.target).attr("stroke-width")).attr("stroke-width","1").attr("stroke","black"),A.style("visibility","visible").text("Viewership: ".concat(Math.round(e.viewership),"\nEpisode: ").concat(e.episode,"\n")+"Act: ".concat(e.act,"\n")+("NVT"!==e.chapter?"Chapter: ".concat(e.chapter,"\n"):"")+("NVT"!==e.segment?"Segment: ".concat(e.segment):""))})).on("mousemove",(function(t){A.style("top",t.pageY-10+"px").style("left",t.pageX+10+"px")})).on("mouseout",(function(t){g.g(t.target).attr("stroke-width",g.g(t.target).attr("stroke-width-cache")).attr("stroke-width-cache",null).attr("stroke","white"),A.style("visibility","hidden")}));var S=t.map((function(t){return t.act})).filter(w),B=t.map((function(t){return t.chapter})).filter(w),M=S.length,C=B.length,E=100,F=100*C/M,I=E/M*5,L=Object.fromEntries(S.map((function(t){return[t,new Set]})));t.map((function(t){L[t.act].add(t.chapter)})),console.log(L);var T=p.select(".legendGrid");T.selectAll("path").remove(),T.selectAll("text").remove(),S.map((function(t,e){B.map((function(a,r){var n=T.append("path").attr("d",g.i().type(g.j).size(I)).attr("transform","translate(".concat(e/M*E,",\n                                          ").concat((1-C+r)/C*F,")"));a in c[t]&&L[t].has(a)?n.attr("fill",c[t][a]):n.attr("fill","#787878")})),T.append("text").text(t).attr("transform","translate(".concat(e/M*E,",").concat(-F,") rotate(90)")).attr("text-anchor","end")})),B.map((function(t,e){T.append("text").text("NVT"!==t?t:"").attr("transform","translate(".concat(E,",").concat((1-C+e)/C*F,")")).attr("text-anchor","start")})),h.a.setFrameHeight()}}]),a}(h.b),k=Object(h.c)(b);c.a.render(Object(y.jsx)(i.a.StrictMode,{children:Object(y.jsx)(k,{})}),document.getElementById("root"))}},[[226,1,2]]]);
//# sourceMappingURL=main.264bf0c0.chunk.js.map