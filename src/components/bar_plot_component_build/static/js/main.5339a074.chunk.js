(this.webpackJsonpstreamlit_viewership_component=this.webpackJsonpstreamlit_viewership_component||[]).push([[0],{226:function(t,e,a){"use strict";a.r(e);var r,n,o=a(0),i=a.n(o),s=a(50),c=a.n(s),l=a(9),d=a(1),p=a(2),u=a(3),h=a(4),m=a(53),f=a(16),g=a(65),v=a(231),y=a(34),x=a(222),b=function(t){Object(u.a)(a,t);var e=Object(h.a)(a);function a(){var t;Object(d.a)(this,a);for(var o=arguments.length,i=new Array(o),s=0;s<o;s++)i[s]=arguments[s];return(t=e.call.apply(e,[this].concat(i))).componentDidMount=function(){var e=t.get_dimensions(),a=Object(l.a)(e,3),o=a[0],i=a[1],s=a[2];t.setState({zoom:[1,r]});var c=f.g("#"+n).append("svg").attr("width",o+s.left+s.right).attr("height",i+s.top+s.bottom).call((function(t){var e=f.g(t.node().parentNode),a=parseInt(t.style("width")),r=parseInt(t.style("height")),n=a/r;function o(){var a=parseInt(e.style("width"));t.attr("width",a),t.attr("height",Math.round(a/n)),m.a.setFrameHeight()}t.attr("viewBox","0 0 ".concat(a," ").concat(r)).attr("perserveAspectRatio","xMinYMid").call(o),f.g(window).on("resize.".concat(e.attr("id")),o)})).append("g").attr("transform","translate(".concat(s.left,",").concat(s.top,")"));c.append("defs").append("svg:clipPath").attr("id","clip").append("svg:rect").attr("width",o).attr("height",i).attr("x",0).attr("y",0),c.append("g").attr("transform","translate(0,".concat(i,")")).attr("id","myXaxis"),c.append("g").attr("id","myYaxis"),f.g("body").append("div").attr("class","svg-tooltip").style("font-family",'-apple-system, system-ui, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif, "Apple   Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"').style("border-radius",".1rem").style("font-size","14px").style("max-width","320px").style("text-overflow","ellipsis").style("white-space","pre").style("z-index","300").style("background","rgba(69,77,93,.9)").style("color","#fff").style("display","block").style("padding",".2rem .4rem").style("position","absolute").style("visibility","hidden"),c.append("text").attr("id","yLabel").attr("transform","translate(".concat(o/2," ,").concat(-10,")")).style("font-size",25).style("text-anchor","middle"),c.append("text").attr("id","topLabel").attr("transform","rotate(-90)").attr("y",-s.left).attr("x",-i/2).attr("dy","1em").style("font-size",25).style("text-anchor","middle"),c.append("g").attr("class","colourLegend").attr("transform","translate(".concat(o+20,",").concat(i-20,")")),m.a.setFrameHeight()},t.render=function(){var e=t.get_data(),a=t.get_dimensions(),o=Object(l.a)(a,3),i=(o[0],o[1],o[2]),s=t.get_theme(),c=e.map((function(t){return t.episode.toString()})).filter((function(t,e,a){return a.indexOf(t)===e}));r=c.length,n="bar_plot_component_".concat(t.props.args.key);var d={};return c.map((function(t,e){return d[e+1]="".concat(t),0})),Object(y.jsxs)("span",{children:[Object(y.jsx)("div",{id:n}),Object(y.jsx)("div",{style:{margin:"40px ".concat(i.right/2,"px 40px ").concat(i.left/2,"px")},id:n+"_silder",children:Object(y.jsx)(g.a,{theme:{token:{colorPrimary:null===s||void 0===s?void 0:s.secondaryBackgroundColor,colorFillContentHover:null===s||void 0===s?void 0:s.secondaryBackgroundColor,colorPrimaryBorder:null===s||void 0===s?void 0:s.secondaryBackgroundColor,colorPrimaryBorderHover:null===s||void 0===s?void 0:s.secondaryBackgroundColor}},children:Object(y.jsx)(v.a,{range:!0,id:"zoomSlider",min:1,max:r,marks:d,step:1,defaultValue:[1,r],onAfterChange:t.handleChangeEpisodeBounds,tooltip:{open:!1},disabled:t.props.disabled})})})]})},t.handleChangeEpisodeBounds=function(e){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:800,o=1200-80-220,i=600-30-30,s=e[0],c=e[1],l=c-s+1,d=f.g("#"+n).select("svg").select("g"),p=d.select("#myXaxis"),u=[],h={};d.selectAll(".dataRect").each((function(t){u.push(t.episode)}));u=u.filter((function(t,e,a){return a.indexOf(t)===e})),u.map((function(t,e){return h[t]=e+1,0}));var m=f.k().scaleExtent([1,r]).on("zoom",(function(t){var e=f.f().domain([.5,r+.5]).range([0,o]),a=t.transform.rescaleX(e);p.call(f.a(a).ticks(l).tickFormat((function(t){return t-1>-1&&t-1<u.length?"Episode ".concat(u[t-1]):""})).tickSize(0)),p.selectAll(".tick text").attr("font-size","".concat(Math.min(150/l,20))),d.selectAll(".dataRect").attr("x",(function(t){return a(t.startTime+h[t.episode]-.5)})).attr("width",(function(t){return a(t.endTime+h[t.episode]-.5)-a(t.startTime+h[t.episode]-.5)})).attr("stroke-width","".concat(Math.min(.7,4/l))),d.selectAll(".gridLine").attr("d",(function(t){var e=f.d();return e.moveTo(a(t),0),e.lineTo(a(t),i+10),e}))})),g=x.cloneDeep(f.l);g.k=r/l,g.x=o/l*(1-s),d.transition().duration(a).call(m.transform,g),t.setState({zoom:[s,c]})},t}return Object(p.a)(a,[{key:"get_data",value:function(){for(var t=this.props.args.data,e=[],a=t.columns,r=function(r){var n=f.e(0,a).map((function(e){var a=t.getCell(r,e),n=(a.classNames,a.content);a.id,a.type;return null===n||void 0===n?void 0:n.toString()}));e.push({index:r,episode:parseInt(n[1]),act:n[2],chapter:n[3],segment:n[4],startTime:parseFloat(n[5]),endTime:parseFloat(n[6]),viewership:parseFloat(n[7])})},n=1;n<t.rows;n++)r(n);return e}},{key:"get_metadata",value:function(){return this.props.args.metadata}},{key:"get_theme",value:function(){return this.props.theme}},{key:"get_dimensions",value:function(){var t={top:30,right:220,bottom:30,left:80};return[1200-t.left-t.right,600-t.top-t.bottom,t]}},{key:"componentDidUpdate",value:function(){var t=this,e=this.get_data(),a=this.get_metadata(),o=this.get_dimensions(),i=Object(l.a)(o,3),s=i[0],c=i[1],d=(i[2],a.colour),p=this.get_theme(),u=f.g("#"+n).select("svg").select("g");u.select("#yLabel").text("".concat(a.granularity)),u.select("#topLabel").text("".concat(a.metric));var h=f.f().domain([.5,r+.5]).range([0,s]),g=f.f().range([c,0]),v=this.state.zoom[0],y=this.state.zoom[1]-v+1,b=x.cloneDeep(f.l);b.k=r/y,b.x=s/y*(1-v),h=b.rescaleX(h);var k=u.select("#myXaxis"),w=u.select("#myYaxis"),j=function(t,e,a){return a.indexOf(t)===e},M=e.map((function(t){return t.episode})).filter(j),A={};M.map((function(t,e){return A[t]=e+1,0})),k.call(f.a(h).ticks(y).tickFormat((function(t){return t-1>-1&&t-1<M.length?"Episode ".concat(M[t-1]):""})).tickSize(0)),k.selectAll(".tick text").attr("font-size","".concat(Math.min(150/y,20))),g.domain([0,1.1*f.c(e,(function(t){return t.viewership}))]),w.call(f.b(g)),w.selectAll(".tick text").attr("font-size","15"),u.selectAll(".dataRect").data(e).join("rect").attr("clip-path","url(#clip)").attr("x",(function(t){return h(t.startTime+A[t.episode]-.5)})).attr("width",(function(t){return h(t.endTime+A[t.episode]-.5)-h(t.startTime+A[t.episode]-.5)})).attr("y",(function(t){return g(t.viewership)})).attr("height",(function(t){return c-g(t.viewership)})).attr("fill",(function(t){return d[t.act][t.chapter]})).attr("class","dataRect").attr("stroke-width","".concat(Math.min(.7,4/y))).attr("stroke","white");for(var _=[],z=1;z<r+1;z++)_.push(z+.5);u.selectAll(".gridLine").data(_).join("path").attr("clip-path","url(#clip)").attr("d",(function(t){var e=f.d();return e.moveTo(h(t),0),e.lineTo(h(t),c+10),e})).attr("fill","none").attr("stroke",null!=p?p.textColor:"rgb(150,150,150)").attr("stroke-width",1).attr("class","gridLine");var O=f.g("body").select(".svg-tooltip");f.h(".dataRect").on("mouseover",(function(t,e){f.g(t.target).attr("stroke-width-cache",f.g(t.target).attr("stroke-width")).attr("stroke-width","1").attr("stroke","black"),O.style("visibility","visible").text("Viewership: ".concat(Math.round(e.viewership)).concat(a.metric_postfix,"\nEpisode: ").concat(e.episode,"\n")+"Act: ".concat(e.act,"\n")+("NVT"!==e.chapter?"Chapter: ".concat(e.chapter,"\n"):"")+("NVT"!==e.segment?"Segment: ".concat(e.segment):""))})).on("mousemove",(function(t){O.style("top","".concat(t.pageY-10,"px")).style("left","".concat(t.pageX+10,"px"))})).on("mouseout",(function(t){f.g(t.target).attr("stroke-width",f.g(t.target).attr("stroke-width-cache")).attr("stroke-width-cache",null).attr("stroke","white"),O.style("visibility","hidden")}));var S=e.filter((function(e){return e.episode>=t.state.zoom[0]&&e.episode<=t.state.zoom[1]})).map((function(t){return t.act})).filter(j),T=u.select(".colourLegend");T.selectAll("path").remove(),T.selectAll("text").remove();var C=Math.pow(20,2);function q(t){var e=t.startsWith("#")?t.slice(1):t,a=parseInt(e.substr(0,2),16)/255,r=parseInt(e.substr(2,2),16)/255,n=parseInt(e.substr(4,2),16)/255,o=Math.min(a,r,n),i=Math.max(a,r,n),s=0;0!==i&&(s=(i-o)/i);return s=Math.round(100*s)/100}if(S.length>1){var B=e.map((function(t){return t.act})).filter(j);B.map((function(t,a){var r=e.filter((function(e){return e.act===t})).map((function(t){return t.chapter})).filter(j),n=r[Math.floor(r.length/2)],o=T.append("path").attr("d",f.i().type(f.j).size(C)).attr("transform","translate(".concat(Math.sqrt(C),",\n                                          ").concat(2*(a-B.length+1)*Math.sqrt(C),")"));return n in d[t]?o.attr("fill",d[t][n]):o.attr("fill","#787878"),T.append("text").text(t).attr("transform","translate(".concat(2*Math.sqrt(C),",\n                                          ").concat((2*(a-B.length+1)+.25)*Math.sqrt(C),")")),0})),T.append("text").text("Act:").attr("transform","translate(".concat(.5*Math.sqrt(C),",\n                                        ").concat((2*-B.length+.25)*Math.sqrt(C),")"))}else if(1===S.length){var I=S[0],F=e.filter((function(t){return t.act===I})).map((function(t){return t.chapter})).filter(j).sort((function(t,e){return function(t,e,a){if(!(e in d[t])||!(a in d[t]))return 0;var r=q(d[t][e]),n=q(d[t][a]);return r<n?-1:r>n?1:0}(I,t,e)}));F.map((function(t,e){var a=T.append("path").attr("d",f.i().type(f.j).size(C)).attr("transform","translate(".concat(Math.sqrt(C),",\n                                          ").concat(2*(e-F.length+1)*Math.sqrt(C),")"));return t in d[I]?a.attr("fill",d[I][t]):a.attr("fill","#AAAA00"),T.append("text").text(t).attr("transform","translate(".concat(2*Math.sqrt(C),",\n                                          ").concat((2*(e-F.length+1)+.25)*Math.sqrt(C),")")),0})),T.append("text").text("Chapter:").attr("transform","translate(".concat(.5*Math.sqrt(C),",\n                                        ").concat((2*-F.length+.25)*Math.sqrt(C),")"))}m.a.setFrameHeight()}}]),a}(m.b),k=Object(m.c)(b);c.a.render(Object(y.jsx)(i.a.StrictMode,{children:Object(y.jsx)(k,{})}),document.getElementById("root"))}},[[226,1,2]]]);
//# sourceMappingURL=main.5339a074.chunk.js.map