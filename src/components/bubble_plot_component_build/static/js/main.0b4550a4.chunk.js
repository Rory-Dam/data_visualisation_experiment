(this.webpackJsonpstreamlit_viewership_component=this.webpackJsonpstreamlit_viewership_component||[]).push([[0],{126:function(t,e,a){},128:function(t,e,a){"use strict";a.r(e);var n,i=a(12),r=a.n(i),o=a(45),c=a.n(o),s=a(9),l=a(0),p=a(1),u=a(2),d=a(3),h=a(21),m=a(7),f=a(47),y=(a(126),a(13)),v=function(t){Object(u.a)(a,t);var e=Object(d.a)(a);function a(){var t;Object(l.a)(this,a);for(var i=arguments.length,r=new Array(i),o=0;o<i;o++)r[o]=arguments[o];return(t=e.call.apply(e,[this].concat(r))).componentDidMount=function(){var e=t.get_dimensions(),a=Object(s.a)(e,3),i=a[0],r=a[1],o=a[2];var c=m.i("#"+n).append("svg").attr("width",i+o.left+o.right).attr("height",r+o.top+o.bottom).call((function(t){var e=m.i(t.node().parentNode),a=parseInt(t.style("width")),n=parseInt(t.style("height")),i=a/n;function r(){var a=parseInt(e.style("width"));t.attr("width",a),t.attr("height",Math.round(a/i)),h.a.setFrameHeight()}t.attr("viewBox","0 0 ".concat(a," ").concat(n)).attr("perserveAspectRatio","xMinYMid").call(r),m.i(window).on("resize.".concat(e.attr("id")),r)})).append("g").attr("transform","translate(".concat(o.left,", ").concat(o.top,")"));c.append("defs").append("svg:clipPath").attr("id","clip").append("svg:rect").attr("width",i).attr("height",r).attr("x",0).attr("y",0),c.append("rect").attr("id","zoomRect").attr("width",i+o.left+o.right).attr("height",r).style("fill","none").style("pointer-events","all").attr("transform","translate(".concat(-o.left,", 0)")),c.append("g").attr("transform","translate(0,".concat(r,")")).attr("id","myXaxis"),c.append("g").attr("id","myYaxis"),m.i("body").append("div").attr("class","svg-tooltip").style("font-family",'-apple-system, system-ui, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif, "Apple   Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"').style("border-radius",".1rem").style("font-size","14px").style("max-width","320px").style("text-overflow","ellipsis").style("white-space","pre").style("z-index","300").style("background","rgba(69,77,93,.9)").style("color","#fff").style("display","block").style("padding",".2rem .4rem").style("position","absolute").style("visibility","hidden"),c.append("text").attr("id","yLabel").attr("transform","rotate(-90)").attr("y",-o.left).attr("x",-r/2).attr("dy","1em").style("font-size",20).style("text-anchor","middle"),c.append("g").attr("class","legendSize").attr("transform","translate(".concat(i,", 20)")),h.a.setFrameHeight()},t.render=function(){return n="bubble_component_".concat(t.props.args.key),Object(y.jsxs)("span",{children:[Object(y.jsx)("div",{id:n}),Object(y.jsx)("div",{className:"button_container",id:"chapter_button_container"}),Object(y.jsxs)("div",{className:"button_container",children:[Object(y.jsx)("a",{id:"show_all_button",className:"ripple_button",children:"Show All Chapters"}),Object(y.jsx)("a",{id:"swap_view_button",className:"ripple_button",children:"To Episode View"})]})]})},t}return Object(p.a)(a,[{key:"get_data",value:function(){for(var t=this.props.args.data,e=[],a=t.columns,n=function(n){var i=m.f(0,a).map((function(e){var a=t.getCell(n,e),i=(a.classNames,a.content);a.id,a.type;return null===i||void 0===i?void 0:i.toString()}));e.push({index:n,episode:parseInt(i[1]),act:i[2],chapter:i[3],segment:i[4],startTime:parseFloat(i[5]),endTime:parseFloat(i[6]),viewership:parseFloat(i[7])})},i=1;i<t.rows;i++)n(i);return e}},{key:"get_metadata",value:function(){return this.props.args.metadata}},{key:"get_theme",value:function(){return this.props.theme}},{key:"get_dimensions",value:function(){var t={top:80,right:150,bottom:80,left:80};return[1200-t.left-t.right,600-t.top-t.bottom,t]}},{key:"componentDidUpdate",value:function(){var t,e,a=this,i=this.get_data(),r=this.get_metadata(),o=this.get_dimensions(),c=Object(s.a)(o,3),l=c[0],p=c[1],u=(c[2],r.colour),d=m.i("#"+n).select("svg").select("g"),y={};r.chapter_order.map((function(t,e){return t in y||(y[t]=e+1),0}));var v=Object.keys(y).length,g=i.sort((function(t,e){return t.endTime-t.startTime>e.endTime-e.startTime?-1:t.endTime-t.startTime<e.endTime-e.startTime?1:0})),b=m.g().domain([0,v+1]).range([0,l]),w=m.g().domain([0,1.1*m.c(i,(function(t){return t.viewership}))]).range([p,0]),x=m.g().domain([0,Math.sqrt(m.d(i,(function(t){return t.endTime-t.startTime})))/Math.PI]).range([0,Math.min(30,l/m.c(i,(function(t){return t.episode}))/2*.5)]),_=m.i("#myXaxis"),k=m.i("#myYaxis"),j={};Object.keys(y).map((function(t,e){return j[e+1]=t,0})),_.call(m.a(b).ticks(v).tickFormat((function(t){return j[t]}))),k.call(m.b(w).tickSize(-l)),k.selectAll("text").style("font-size","15");var A=!1;!1===d.select("#dataCircle").empty()&&"episode"===d.select("#dataCircle").attr("view")&&(A=!0);var T=i.map((function(t){return t.act})).filter((function(t,e,a){return a.indexOf(t)===e})),O=Object.fromEntries(T.map((function(t){return[t,m.c(i.map((function(t){return t.episode})))]}))),C=Object.fromEntries(T.map((function(t){return[t,0]})));i.map((function(t){return t.episode<O[t.act]&&(O[t.act]=t.episode),t.episode>C[t.act]&&(C[t.act]=t.episode),0}));for(var M=[],S=0;S<Object.entries(O).map((function(t){return t[0]})).length;S++){var z=Object.entries(O).map((function(t){return t[0]}))[S];M.push({act:z,start:O[z]-.5,stop:C[z]+.5})}d.selectAll(".actLine").data(M).join("path").attr("clip-path","url(#clip)").attr("d",(function(){var t=m.e();return t.moveTo(0,0),t.lineTo(0,p),t})).attr("fill","none").attr("stroke","black").attr("stroke-width",1).style("stroke-dasharray","4, 4").attr("class","actLine"),d.selectAll(".actRect").data(M).join("rect").attr("clip-path","url(#clip)").style("pointer-events","none").attr("fill",(function(t){return r.act_colour[t.act]})).style("opacity","0").attr("width","0").attr("height",p).attr("class","actRect"),d.selectAll(".actLabel").data(M).join("text").text((function(t){return t.act})).attr("transform","translate(0, -5)").style("opacity","0").style("text-anchor","middle").attr("class","actLabel");var E=m.i("body").select(".svg-tooltip");d.selectAll("#dataCircle").data(g).join("circle").attr("id","dataCircle").attr("view","chapter").attr("clip-path","url(#clip)").attr("r",(function(t){return x(Math.sqrt(t.endTime-t.startTime)/Math.PI)})).attr("cx",(function(t){return b(y[t.chapter])})).attr("cy",(function(t){return w(t.viewership)})).attr("fill",(function(t){return u[t.chapter]})).style("opacity","0.7").style("pointer-events","auto").on("mouseover",(function(t,e){m.i(t.target).attr("stroke-width","1").attr("stroke","black"),E.style("visibility","visible").text("Viewership: ".concat(Math.round(e.viewership)).concat(r.metric_postfix,"\nEpisode: ").concat(e.episode,"\n")+"Act: ".concat(e.act,"\nChapter: ").concat(e.chapter,"\nSegment: ").concat(e.segment,"\n")+"Start(s): ".concat(e.startTime,"\nEnd(s): ").concat(e.endTime))})).on("mousemove",(function(t){E.style("top","".concat(t.pageY-10,"px")).style("left","".concat(t.pageX+10,"px"))})).on("mouseout",(function(t){m.i(t.target).attr("stroke-width",null).attr("stroke",null),E.style("visibility","hidden")})).attr("view","chapter"),d.select("#yLabel").text(r.metric);var F=Math.pow(10,Math.floor(Math.log10(m.c(i,(function(t){return t.endTime-t.startTime}))))),I=[.1,.25,.5,1].map((function(t){return t*F})),L=I.map((function(t){return x(Math.sqrt(t)/Math.PI)})),R=m.h().domain(I.map((function(t){return"".concat(t,"s")}))).range(L),N=f.a.legendSize().ascending(!0).title("Segment Time").shape("circle").shapePadding(5).labelOffset(10).orient("vertical").scale(R);d.select(".legendSize").call(N).selectAll("circle").style("opacity",.5),d.select(".legendSize").selectAll("text").style("font-size","20");var Y=m.j().scaleExtent([1,20]).extent([[0,0],[l,p]]).on("zoom",(function(t){if(!isNaN(t.transform.k)){var e=t.transform.rescaleY(w);k.call(m.b(e).tickSize(-l)),k.selectAll("text").style("font-size","15"),d.selectAll("#dataCircle").attr("cy",(function(t){return e(t.viewership)}))}}));function V(t){var e=t.clientX-t.target.offsetLeft,a=t.clientY-t.target.offsetTop,n=document.createElement("div");n.style.left="".concat(e,"px"),n.style.top="".concat(a,"px"),t.target.append(n),setTimeout((function(){n.remove()}),800)}d.select("#zoomRect").call(Y),null===(t=document.getElementById("zoomRect"))||void 0===t||t.dispatchEvent(new WheelEvent("wheel",{deltaY:1})),null===(e=document.getElementById("zoomRect"))||void 0===e||e.dispatchEvent(new WheelEvent("wheel",{deltaY:-1})),A&&this.swapView(r.chapter_order,0),this.showAll(0),m.i("#swap_view_button").on("click",(function(t){a.swapView(r.chapter_order),V(t)})),m.i("#show_all_button").on("click",(function(t){a.showAll(),V(t)}));var X=m.i("#chapter_button_container"),B=this.swapShowChapter;X.selectAll(".ripple_button").data(Object.keys(y)).join("a").attr("id",(function(t){return"show_".concat(t,"_button")})).attr("class","ripple_button").style("background-color",(function(t){return u[t]})).style("color",(function(t){return function(t){t=t.replace("#","");var e=(.299*parseInt(t.substr(0,2),16)+.587*parseInt(t.substr(2,2),16)+.114*parseInt(t.substr(4,2),16))/255;return(Math.max(e,.1)+.05)/(Math.min(e,.1)+.05)>=4.5?"#000000":"#FFFFFF"}(u[t])})).text((function(t){return t})).on("click",(function(t,e){m.i(this).style("opacity","1"===m.i(this).style("opacity")?"0.5":"1"),B(e)})),h.a.setFrameHeight()}},{key:"swapView",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:800,a=m.i("#"+n).select("svg").select("g");if("chapter"===a.select("#dataCircle").attr("view"))return m.i("#swap_view_button").text("To Chapter View"),void function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:800,e={top:80,right:150,bottom:80,left:80},a=1200-e.left-e.right,i=600-e.top-e.bottom,r=m.i("#"+n).select("svg").select("g"),o=0;r.selectAll("#dataCircle").each((function(t){t.episode>o&&(o=t.episode)}));var c=m.g().domain([0,o+1]).range([0,a]);m.i("#myXaxis").transition().duration(t).call(m.a(c).ticks(o).tickFormat((function(t){if(t>0&&t<=o)return"Episode ".concat(t)}))),r.selectAll("#dataCircle").attr("view","episode").transition().duration(t).attr("cx",(function(t){return c(t.episode)})),r.selectAll(".actLine").transition().duration(t).attr("d",(function(t){console.log(t);var e=m.e();return e.moveTo(c(t.stop),0),e.lineTo(c(t.stop),i),e})),r.selectAll(".actLabel").transition().duration(t).style("opacity","1").attr("transform",(function(t){return"translate(".concat(c((t.stop+t.start)/2),", -5)")})),r.selectAll(".actRect").transition().duration(t).style("opacity","0.2").attr("width",(function(t){return c(t.stop)-c(t.start)})).attr("transform",(function(t){return"translate(".concat(c(t.start),", 0)")}))}(e);"episode"===a.select("#dataCircle").attr("view")&&(m.i("#swap_view_button").text("To Episode View"),function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:800,a={top:80,right:150,bottom:80,left:80},i=1200-a.left-a.right,r=600-a.top-a.bottom,o=m.i("#"+n).select("svg").select("g"),c={};null===t||void 0===t||t.map((function(t,e){return t in c||(c[t]=e+1),0}));var s=Object.keys(c).length,l=m.g().domain([0,s+1]).range([0,i]),p=m.i("#myXaxis"),u={};Object.keys(c).map((function(t,e){u[e+1]=t})),p.transition().duration(e).call(m.a(l).ticks(s).tickFormat((function(t){return u[t]}))),o.selectAll("#dataCircle").attr("view","chapter").transition().duration(e).attr("cx",(function(t){return l(c[t.chapter])})),o.selectAll(".actLine").transition().duration(e).attr("d",(function(t){var e=m.e();return e.moveTo(0,0),e.lineTo(0,r),e})),o.selectAll(".actLabel").transition().duration(e).style("opacity","0").attr("transform","translate(0, -5)"),o.selectAll(".actRect").transition().duration(e).style("opacity","0").attr("width","0").attr("transform","translate(0, 0)")}(t,e))}},{key:"showAll",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:400;m.i("#"+n).select("svg").select("g").selectAll("#dataCircle").transition().duration(t).style("opacity","0.7").style("pointer-events","auto"),m.i("#chapter_button_container").selectAll(".ripple_button").style("opacity","1")}},{key:"swapShowChapter",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:400;m.i("#"+n).select("svg").select("g").selectAll("#dataCircle").transition().duration(e).style("opacity",(function(e){return e.chapter===t?"0.7"===m.i(this).style("opacity")?"0":"0.7":m.i(this).style("opacity")})).style("pointer-events",(function(e){return e.chapter===t?"auto"===m.i(this).style("pointer-events")?"none":"auto":m.i(this).style("pointer-events")}))}}]),a}(h.b),g=Object(h.c)(v);c.a.render(Object(y.jsx)(r.a.StrictMode,{children:Object(y.jsx)(g,{})}),document.getElementById("root"))}},[[128,1,2]]]);
//# sourceMappingURL=main.0b4550a4.chunk.js.map